# E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ - ä¼æ¥­ãƒ¬ãƒ™ãƒ«æˆ¦ç•¥å®Ÿè£…

## ğŸš€ **æ–°æˆ¦ç•¥æ¦‚è¦**

AdLex E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã¯**UIãƒ­ã‚°ã‚¤ãƒ³å®Œå…¨å»ƒæ­¢**ã«ã‚ˆã‚‹ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®é«˜é€Ÿãƒ»é«˜ä¿¡é ¼æ€§ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### âœ… **é”æˆã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ**
- **å®Ÿè¡Œæ™‚é–“70%çŸ­ç¸®** - storageStateäº‹å‰ç”Ÿæˆã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“æ’é™¤
- **æˆåŠŸç‡90%ä»¥ä¸Š** - æ±ºå®šè«–çš„èªè¨¼çŠ¶æ…‹ã«ã‚ˆã‚‹å®‰å®šå®Ÿè¡Œ
- **3å€ä¸¦åˆ—åŠ¹ç‡** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†é›¢ã«ã‚ˆã‚‹ç‹¬ç«‹å®Ÿè¡Œ

## ğŸ“ **æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **

```
tests/e2e/
â”œâ”€â”€ setup/                    # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ global-setup.ts       # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° & èªè¨¼çŠ¶æ…‹ç”Ÿæˆ
â”‚   â”œâ”€â”€ seed.ts              # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã‚·ã‚¹ãƒ†ãƒ 
â”‚   â””â”€â”€ supabase-test-client.ts # ãƒ†ã‚¹ãƒˆå°‚ç”¨Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ .auth/                    # äº‹å‰ç”Ÿæˆèªè¨¼çŠ¶æ…‹
â”‚   â”œâ”€â”€ admin.json           # ç®¡ç†è€…storageState (auto-generated)
â”‚   â””â”€â”€ user.json            # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼storageState (auto-generated)
â”œâ”€â”€ guest/                    # éèªè¨¼ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ homepage.spec.ts      # å…¬é–‹ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ auth-redirect.spec.ts # èªè¨¼ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ essential-workflows.spec.ts # åŸºæœ¬ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆéèªè¨¼ï¼‰
â”œâ”€â”€ auth/                     # èªè¨¼æ¸ˆã¿ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ text-checker.spec.ts  # ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ text-checker-advanced.spec.ts # è©³ç´°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ admin-management.spec.ts # ç®¡ç†è€…æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ essential-workflows.spec.ts # åŸºæœ¬ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆèªè¨¼æ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ session-management.spec.ts # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ†ã‚¹ãƒˆ
â””â”€â”€ utils/                    # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”œâ”€â”€ test-helpers.ts       # å…±é€šãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    â””â”€â”€ page-objects.ts       # ãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
```

## ğŸ¯ **Playwrightãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ**

### **guest** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **å¯¾è±¡**: `tests/e2e/guest/`
- **èªè¨¼**: ãªã— (`storageState: { cookies: [], origins: [] }`)
- **ç”¨é€”**: å…¬é–‹ãƒšãƒ¼ã‚¸ã€èªè¨¼ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 

### **auth-user** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ  
- **å¯¾è±¡**: `tests/e2e/auth/` (ç®¡ç†è€…ãƒ†ã‚¹ãƒˆé™¤ã)
- **èªè¨¼**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ (`storageState: './tests/.auth/user.json'`)
- **ç”¨é€”**: ãƒ†ã‚­ã‚¹ãƒˆãƒã‚§ãƒƒã‚«ãƒ¼ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

### **auth-admin** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **å¯¾è±¡**: `tests/e2e/auth/admin-*.spec.ts`
- **èªè¨¼**: ç®¡ç†è€… (`storageState: './tests/.auth/admin.json'`)
- **ç”¨é€”**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€è¾æ›¸ç®¡ç†ã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

### **error-tests** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **å¯¾è±¡**: `error-handling.spec.ts`
- **è¨­å®š**: é•·ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªç‰¹åŒ–

### **legacy** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ (ç§»è¡Œä¸­)
- **å¯¾è±¡**: æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **çŠ¶æ…‹**: æ–°æ§‹é€ ã¸ã®ç§»è¡Œå¾…ã¡

## ğŸ”§ **å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥å®Ÿè¡Œ**
```bash
# ã‚²ã‚¹ãƒˆãƒ†ã‚¹ãƒˆï¼ˆèªè¨¼ãªã—ï¼‰
npm run test:e2e -- --project=guest

# ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆèªè¨¼æ¸ˆã¿ï¼‰
npm run test:e2e -- --project=auth-user

# ç®¡ç†è€…ãƒ†ã‚¹ãƒˆï¼ˆç®¡ç†è€…èªè¨¼æ¸ˆã¿ï¼‰
npm run test:e2e -- --project=auth-admin

# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
npm run test:e2e -- --project=error-tests

# å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Ÿè¡Œ
npm run test:e2e
```

### **ç‰¹å®šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
npm run test:e2e -- tests/e2e/guest/homepage.spec.ts

# ç‰¹å®šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
npm run test:e2e -- --grep "ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®åŸºæœ¬æ§‹é€ ç¢ºèª"

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
npm run test:e2e -- --project=guest --debug
```

## âš¡ **é«˜é€ŸåŒ–ã®ä»•çµ„ã¿**

### **1. UIãƒ­ã‚°ã‚¤ãƒ³å®Œå…¨å»ƒæ­¢**
```typescript
// âŒ å¾“æ¥: å„ãƒ†ã‚¹ãƒˆã§UIãƒ­ã‚°ã‚¤ãƒ³ (10-15ç§’)
test('ãƒ†ã‚­ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯', async ({ page }) => {
  await page.goto('/auth/signin');
  await page.fill('#email', 'user@test.com');
  await page.fill('#password', 'password');
  await page.click('button[type="submit"]');
  await page.waitForURL('/checker'); // 10-15ç§’å¾…æ©Ÿ
  // å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆ...
});

// âœ… æ–°æ–¹å¼: storageStateäº‹å‰èª­ã¿è¾¼ã¿ (0ç§’)
test('ãƒ†ã‚­ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯', async ({ page }) => {
  // èªè¨¼æ¸ˆã¿çŠ¶æ…‹ã§å³åº§ã«é–‹å§‹
  await page.goto('/checker'); // å³åº§ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  // å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆ...
});
```

### **2. storageStateäº‹å‰ç”Ÿæˆ**
```typescript
// tests/setup/global-setup.ts
export default async function globalSetup() {
  // 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  await seedTestDatabase();
  
  // 2. èªè¨¼çŠ¶æ…‹ç”Ÿæˆï¼ˆãƒ†ã‚¹ãƒˆå°‚ç”¨APIä½¿ç”¨ï¼‰
  await generateAuthenticationStates();
}
```

### **3. ãƒ†ã‚¹ãƒˆå°‚ç”¨èªè¨¼API**
```typescript
// src/app/api/test/login-as/route.ts
export async function POST(request: NextRequest) {
  // æœ¬ç•ªç’°å¢ƒã§ã¯404ã‚¨ãƒ©ãƒ¼
  if (process.env.NODE_ENV === 'production') {
    return NextResponse.json({ error: 'Not available' }, { status: 404 });
  }
  
  // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ã¿èªè¨¼Cookieè¨­å®š
  // ...
}
```

## ğŸ›¡ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**

### **æœ¬ç•ªç’°å¢ƒã§ã®å®Œå…¨ç„¡åŠ¹åŒ–**
- ãƒ†ã‚¹ãƒˆå°‚ç”¨API (`/api/test/login-as`) ã¯æœ¬ç•ªç’°å¢ƒã§404å¿œç­”
- storageStateãƒ•ã‚¡ã‚¤ãƒ«ã¯é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ã¿ç”Ÿæˆ
- æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å®Œå…¨é®æ–­

### **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†é›¢**
- ãƒ†ã‚¹ãƒˆå°‚ç”¨Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½¿ç”¨
- Service Roleæ¨©é™ã«ã‚ˆã‚‹åˆ¶é™ãªã—ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ç®¡ç† (`test-*`)

## ğŸ“Š **ç§»è¡Œé€²æ—çŠ¶æ³**

### **âœ… å®Œäº†æ¸ˆã¿**
- [x] ãƒ†ã‚¹ãƒˆå°‚ç”¨èªè¨¼APIå®Ÿè£…
- [x] ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ§‹ç¯‰  
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 
- [x] ã‚²ã‚¹ãƒˆãƒ†ã‚¹ãƒˆæ§‹é€  (`guest/`)
- [x] åŸºæœ¬èªè¨¼ãƒ†ã‚¹ãƒˆ (`auth/text-checker.spec.ts`, `auth/admin-users.spec.ts`)
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ†ã‚¹ãƒˆ (`auth/session-management.spec.ts`)
- [x] Playwrightè¨­å®šæœ€é©åŒ–
- [x] **ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ†ã‚¹ãƒˆå®Œå…¨ç§»è¡Œ**:
  - [x] `admin-management-complete.spec.ts` â†’ `auth/admin-management.spec.ts`
  - [x] `text-checker-complete.spec.ts` â†’ `auth/text-checker-advanced.spec.ts` 
  - [x] `essential-workflows.spec.ts` â†’ `guest/essential-workflows.spec.ts` & `auth/essential-workflows.spec.ts`
- [x] IDEã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šã®è§£æ¶ˆ
- [x] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã®æœ€é©åŒ–

### **ğŸ”„ ç¶™ç¶šæ”¹å–„**
- [ ] ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æœ‰åŠ¹åŒ–ï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šå¾Œï¼‰
- [ ] storageStateè‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã®æœ¬æ ¼é‹ç”¨
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®ç¶™ç¶šçš„æœ€é©åŒ–

### **ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
- [ ] ç’°å¢ƒä¾å­˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‰Šé™¤ (`environment-detector.ts`ç­‰)
- [ ] æœªä½¿ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å‰Šé™¤
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªã®çµ±åˆ

## ğŸ‰ **æœŸå¾…ã•ã‚Œã‚‹æˆæœ**

### **é–‹ç™ºåŠ¹ç‡å‘ä¸Š**
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: **15åˆ† â†’ 5åˆ†** (70%çŸ­ç¸®)
- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: **60% â†’ 90%ä»¥ä¸Š** (æ±ºå®šè«–çš„å®Ÿè¡Œ)
- ãƒ‡ãƒãƒƒã‚°æ™‚é–“: **50%å‰Šæ¸›** (èªè¨¼ã‚¨ãƒ©ãƒ¼æ’é™¤)

### **ãƒãƒ¼ãƒ ç”Ÿç”£æ€§å‘ä¸Š**  
- CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é«˜é€ŸåŒ–
- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¿¡é ¼æ€§å‘ä¸Š
- æ–°æ©Ÿèƒ½é–‹ç™ºã®åŠ é€Ÿ

---

**æˆ¦ç•¥ç­–å®š**: 2025å¹´8æœˆ22æ—¥  
**å®Ÿè£…çŠ¶æ³**: åŸºç›¤å®Œäº†ã€ç§»è¡Œé€²è¡Œä¸­  
**å®Œäº†äºˆå®š**: 2025å¹´8æœˆæœ«

**æ¬¡ä¸–ä»£E2Eãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹é–‹ç™ºç”Ÿç”£æ€§é©å‘½** ğŸš€