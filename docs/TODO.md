# AdLex 開発進捗管理 - 統合TODO

最終更新: 2025-08-08

## 📋 概要

AdLex（薬機法チェック & リライト SaaS）の開発進捗を管理する統合TODOリストです。要件定義書と詳細設計書に基づいて、実装すべき機能を体系的に整理しています。

### 凡例
- ✅ **完了**: 実装済み・テスト済み
- 🔄 **進行中**: 開発中・部分実装
- ⏳ **未着手**: 実装予定
- ❌ **ブロック**: 依存関係により実装不可
- 🎯 **MVP必須**: MVPリリースに必須
- 🚨 **緊急**: 即座の対応が必要

---

## 🎯 Phase 0: 基盤・認証システム

### 0.1 プロジェクトセットアップ
- [x] ✅ Next.js 15 + TypeScript プロジェクト初期化
- [x] ✅ Tailwind CSS + shadcn/ui セットアップ
- [x] ✅ ESLint + Prettier 設定
- [x] ✅ Git リポジトリ初期化
- [x] ✅ 環境変数管理 (.env.local)

### 0.2 データベース基盤
- [x] ✅ Supabase プロジェクト作成
- [x] ✅ PostgreSQL 基本設定
- [x] ✅ pg_trgm 拡張有効化
- [x] ✅ pgvector 拡張有効化
- [x] ✅ データベーススキーマ設計
- [x] ✅ 初期マイグレーション作成

### 0.3 認証システム
- [x] ✅ Supabase Auth 設定
- [x] ✅ メール・パスワード認証
- [x] ✅ AuthContext 実装
- [x] ✅ ログイン・ログアウト機能
- [x] ✅ パスワードリセット機能
- [x] ✅ 認証ガード実装
- [ ] ⏳ 二段階認証機能（将来対応）

### 0.4 組織管理システム
- [x] ✅ 組織テーブル設計・実装
- [x] ✅ ユーザーテーブル設計・実装
- [x] ✅ Row Level Security (RLS) 設定
- [x] ✅ 組織単位のデータ分離
- [x] ✅ ロール管理 (admin/user)

---

## 🎯 Phase 1: ユーザー管理

### 1.1 ユーザー招待システム
- [x] ✅ 招待リンク生成機能
- [x] ✅ メール送信機能 (Resend)
- [x] ✅ 招待受諾フロー
- [x] ✅ 招待期限管理
- [x] ✅ 管理者権限チェック

### 1.2 ユーザー管理UI
- [x] ✅ ユーザー一覧画面
- [x] ✅ ユーザー詳細画面
- [x] ✅ ユーザー招待画面
- [x] ✅ ロール変更機能
- [x] ✅ ユーザー削除機能
- [x] ✅ グローバルナビゲーションコンポーネント

### 1.3 組織設定
- [x] ✅ 組織情報編集画面
- [x] ✅ 利用制限設定
- [ ] ⏳ 組織アイコン・ロゴ設定
- [ ] ⏳ 組織切り替え機能（将来対応）

---

## 🎯 Phase 2: 辞書管理システム

### 2.1 辞書CRUD操作
- [x] ✅ 辞書項目作成機能
- [x] ✅ 辞書項目編集機能
- [x] ✅ 辞書項目削除機能
- [x] ✅ 辞書項目一覧表示
- [x] ✅ カテゴリ管理 (NG/ALLOW)
- [x] ✅ 管理者権限チェック
- [x] ✅ 組織単位での辞書管理
- [x] ✅ `/dictionaries` ルートでの辞書管理ページ機能

### 2.2 辞書検索・フィルタ
- [x] ✅ テキスト検索機能
- [x] ✅ カテゴリフィルタ
- [x] ✅ ページネーション
- [x] ✅ 検索・フィルタリング機能
- [x] ✅ 高度な検索機能
- [x] ✅ ソート機能強化

### 2.3 Embedding システム
- [x] ✅ OpenAI Embedding API 統合
- [x] ✅ 自動ベクトル生成
- [x] ✅ ベクトル検索機能
- [x] ✅ 類似度閾値設定
- [x] ✅ 辞書登録時の自動embedding生成
- [x] ✅ `POST /api/dictionaries/embeddings/refresh` API実装
- [x] ✅ Embedding 再生成機能（UI/管理者向け、進捗表示付き）
- [x] ✅ embedding更新の非同期処理（アプリ内簡易キュー）
- [x] ✅ Upstash QStash によるリトライ機構（受信署名検証・サービスロール更新・自動リトライ・バックオフ）

### 2.4 辞書インポート・エクスポート
 - [x] ✅ CSV インポート機能 🎯
 - [x] ✅ CSV エクスポート機能 🎯
 - [x] ✅ CSVフォーマットバリデーション
 - [x] ✅ バルクアップロード
 - [x] ✅ インポートエラーハンドリング
 - [x] ✅ データ検証機能

### 2.5 辞書管理UI強化
 - [x] ✅ 一括編集機能
 - [x] ✅ 重複検出機能
 - [x] ✅ 辞書項目統計表示
 - [x] ✅ 使用頻度分析

---

## 🎯 Phase 3: テキストチェック機能

### 3.1 基本チェック機能
- [x] ✅ TextChecker コンポーネント
- [x] ✅ テキスト入力UI
- [x] ✅ 文字数カウント・制限（10,000文字）
- [x] ✅ チェック実行機能
- [x] ✅ リアルタイム処理状況表示
- [x] ✅ リアルタイム文字数カウント

### 3.2 AI処理パイプライン
- [x] ✅ プリフィルタ (pg_trgm ≥0.3)
- [x] ✅ セマンティック検索 (pgvector >0.75)
- [x] ✅ OpenAI GPT-4o 統合
- [x] ✅ LM Studio 開発環境対応
- [x] ✅ Function calling 実装
- [x] ✅ プリフィルタ（pg_trgm類似度≥0.3）の最適化
- [x] ✅ セマンティック照合（vector距離<0.25）の実装
- [x] ✅ LLM呼び出しのシステムプロンプト最適化

### 3.3 結果表示システム
- [x] ✅ 原文・修正文並列表示（2カラム）
- [x] ✅ 違反箇所ハイライト
- [x] ✅ 差分表示機能 (inline/side-by-side)
- [x] ✅ 違反詳細表示
- [x] ✅ タブ切替UI
 - [x] ✅ ハイライト色・UI の改善
 - [x] ✅ 違反箇所の詳細情報表示

### 3.4 非同期処理・SSE
- [x] ✅ Server-Sent Events 実装
- [x] ✅ 処理進捗リアルタイム配信
- [x] ✅ エラーハンドリング
- [x] ✅ 接続管理
- [x] ✅ `/api/checks/{id}/stream` エンドポイント
- [x] ✅ 基本的な進捗通知
- [x] ✅ 非同期ジョブ処理の安定化（30秒タイムアウト実装）
- [x] ✅ 平均応答時間≤5秒の達成（段階的フィルタリングで性能向上）
- [x] ✅ 画像処理対応のSSE実装（OCR状態・進捗配信）
- [x] ✅ 非同期処理キューの画像対応拡張
- [x] ✅ データベーススキーマ拡張（画像関連フィールド追加）
- [x] ✅ 型定義更新（database.types.ts）
- [ ] 🔄 処理キャンセル機能
- [ ] 🔄 エラーハンドリングの改善（部分実装）
- [ ] 🔄 接続タイムアウト処理の最適化（部分実装）
- [ ] ⏳ 複数チェック同時実行対応

### 3.5 パフォーマンス最適化
- [ ] ⏳ データベースクエリ最適化 🎯
- [ ] ⏳ 同時処理能力向上
- [ ] ⏳ レスポンス時間短縮（≤5秒）
- [ ] ⏳ メモリ使用量最適化
- [ ] ⏳ キャッシュ機能実装

### 3.6 ファイル・URL対応（将来）
- [ ] ⏳ ファイルアップロード機能（将来対応）
  - [ ] ⏳ Word ファイル対応
  - [ ] ⏳ Markdown ファイル対応
- [ ] ⏳ URL クロール機能（将来対応）

---

## 🎯 Phase 4: 画像アップロード・OCR機能

### 4.1 画像アップロードUI
- [ ] 🚨 ImageChecker コンポーネント作成 🎯
- [ ] ⏳ ドラッグ&ドロップ機能 (react-dropzone)
- [ ] ⏳ 画像プレビュー機能
- [ ] ⏳ ファイル形式・サイズ検証
- [ ] ⏳ 進捗表示UI

### 4.2 画像ストレージ
- [ ] ⏳ Supabase Storage 設定
- [ ] ⏳ 画像アップロード API
- [ ] ⏳ 一時ファイル管理
- [ ] ⏳ 自動削除機能（1時間後）
- [ ] ⏳ アクセス制御設定

### 4.3 OCR処理システム
- [ ] ⏳ Tesseract.js 統合 (MVP) 🎯
- [ ] ⏳ Google Vision API 統合 (本格運用)
- [ ] ⏳ OCR クライアント抽象化
- [ ] ⏳ 画像前処理機能
- [ ] ⏳ OCR結果検証機能

### 4.4 画像チェック API
- [ ] ⏳ POST /api/ocr エンドポイント 🎯
- [ ] ⏳ 画像処理ワークフロー
- [ ] ⏳ OCR→テキストチェック連携
- [ ] ⏳ 処理状況管理
- [ ] ⏳ エラーハンドリング

### 4.5 データベース拡張
- [x] ✅ checks テーブル拡張 🎯
  - [x] ✅ input_type カラム追加
  - [x] ✅ extracted_text カラム追加
  - [x] ✅ image_url カラム追加
  - [x] ✅ ocr_status カラム追加
  - [x] ✅ ocr_metadata カラム追加
  - [x] ✅ error_message カラム追加

### 4.6 レスポンシブUI設計
- [ ] ⏳ モバイル対応レイアウト
- [ ] ⏳ タブレット対応レイアウト
- [ ] ⏳ デスクトップ3カラム表示
- [ ] ⏳ 画像サイズ調整機能

---

## 🎯 Phase 5: 履歴・データ管理

### 5.1 チェック履歴システム
- [x] ✅ 履歴自動保存
- [x] ✅ チェック結果のDB保存
- [ ] 🔄 履歴一覧画面強化
- [ ] 🔄 履歴詳細表示改善
- [ ] ⏳ ユーザー個人の履歴一覧画面
- [ ] ⏳ 履歴検索機能 🎯
- [ ] ⏳ フィルタ・ソート機能
- [ ] ⏳ ページネーション改善
- [ ] ⏳ 管理者による組織全体の履歴検索
- [ ] ⏳ 大量データの効率的な表示（ページネーション）
- [ ] ⏳ 履歴の検索・ソート機能

### 5.2 履歴管理機能
- [ ] 🔄 履歴削除機能（論理削除）
- [ ] ⏳ 履歴エクスポート機能
- [ ] ⏳ 履歴統計表示
- [ ] ⏳ 管理者向け組織履歴
- [ ] ⏳ 履歴の詳細表示・再実行機能

### 5.3 データエクスポート
- [x] ✅ 修正文のコピー機能
- [ ] ⏳ PDF レポート生成 🎯
- [ ] ⏳ CSV エクスポート機能
- [ ] ⏳ Excel エクスポート機能
- [ ] ⏳ ハイライト付きPDF
- [ ] ⏳ カスタムレポート機能
- [ ] ⏳ 原文のコピー機能
- [ ] ⏳ diff形式のコピー機能
- [ ] ⏳ レポートのダウンロード機能
- [ ] ⏳ レポートテンプレートの作成

### 5.4 画像チェック履歴対応
- [ ] ⏳ 画像付き履歴表示
- [ ] ⏳ OCR結果の履歴保存
- [ ] ⏳ 画像・テキスト混合履歴
- [ ] ⏳ 画像プレビュー機能

---

## 🎯 Phase 6: 課金・決済システム

### 6.1 利用制限管理
- [x] ✅ 基本使用量カウント
- [ ] ⏳ トライアル期間管理（30日・200チェック）🎯
- [ ] ⏳ 月間チェック数の制限・カウント
- [ ] ⏳ 超過時の従量課金処理
- [ ] ⏳ 詳細使用量分析
- [ ] ⏳ 使用量アラート
- [ ] ⏳ 使用量ダッシュボード
- [ ] ⏳ 予算管理機能

### 6.2 Stripe 統合
- [ ] ⏳ Stripe アカウント設定 🎯
- [ ] ⏳ Stripe API 統合
- [ ] ⏳ Webhook 設定
- [ ] ⏳ 決済フロー実装
- [ ] ⏳ セキュリティ設定
- [ ] ⏳ クレジットカード決済機能
- [ ] ⏳ 銀行振込対応（Pay.jp連携検討）

### 6.3 料金プラン管理
- [ ] ⏳ プラン設定システム 🎯
- [ ] ⏳ 利用制限管理
- [ ] ⏳ 従量課金機能
- [ ] ⏳ 無料トライアル管理
- [ ] ⏳ プランアップグレード

### 6.4 請求・支払い管理
- [ ] ⏳ 月次請求処理 🎯
- [ ] ⏳ 請求書自動生成
- [ ] ⏳ 領収書発行機能
- [ ] ⏳ 支払い履歴管理
- [ ] ⏳ 支払い失敗処理
- [ ] ⏳ PDF請求書の自動生成
- [ ] ⏳ インボイス対応
- [ ] ⏳ メール送付機能

### 6.5 課金UI
- [ ] ⏳ 料金プラン選択画面
- [ ] ⏳ 支払い方法設定画面
- [ ] ⏳ 請求履歴画面
- [ ] ⏳ 使用量表示画面
- [ ] ⏳ アップグレード画面

---

## 🎯 Phase 7: 性能・セキュリティ強化

### 7.1 パフォーマンス最適化
- [ ] ⏳ データベースインデックス最適化 🎯
- [ ] ⏳ クエリ最適化
- [ ] ⏳ CDN 設定
- [ ] ⏳ 画像最適化
- [ ] ⏳ バンドルサイズ最適化
- [ ] ⏳ 同時アクセス50ユーザー対応
- [ ] ⏳ 月間10,000チェック処理能力
- [ ] ⏳ CDN活用による高速化

### 7.2 セキュリティ強化
- [ ] ⏳ セキュリティ監査実施 🎯
- [ ] ⏳ HTTPS 完全対応
- [ ] ⏳ CSRF 対策強化
- [ ] ⏳ XSS 対策強化
- [ ] ⏳ SQLインジェクション対策
- [ ] ⏳ TLS1.2+ 強制
- [ ] ⏳ at-rest AES-256暗号化確認

### 7.3 可用性・信頼性
- [ ] ⏳ ヘルスチェック実装
- [ ] ⏳ 死活監視設定
- [ ] ⏳ ログ監視システム
- [ ] ⏳ アラート設定
- [ ] ⏳ 障害対応手順書
- [ ] ⏳ Vercel Analytics 設定
- [ ] ⏳ Supabase Logs 活用
- [ ] ⏳ エラー監視・アラート設定
- [ ] ⏳ 90日ログ保持・自動ローテート

### 7.4 バックアップ・復旧
- [ ] ⏳ 自動バックアップ設定 🎯
- [ ] ⏳ Point-in-Time Recovery
- [ ] ⏳ 災害復旧計画
- [ ] ⏳ データ復旧テスト
- [ ] ⏳ バックアップ監視
- [ ] ⏳ DBスナップショット（1回/日）設定
- [ ] ⏳ 7日PITR設定

---

## 🎯 Phase 8: 管理・運用機能

### 8.1 管理者ダッシュボード
- [ ] ⏳ システム概要ダッシュボード
- [ ] ⏳ 使用量統計表示
- [ ] ⏳ ユーザー活動監視
- [ ] ⏳ エラー率監視
- [ ] ⏳ パフォーマンス監視

### 8.2 ユーザーサポート
- [ ] ⏳ お問い合わせフォーム
- [ ] ⏳ FAQ システム
- [ ] ⏳ ヘルプドキュメント
- [ ] ⏳ チュートリアル機能
- [ ] ⏳ サポートチケット管理

### 8.3 システム設定
- [ ] ⏳ システム設定画面
- [ ] ⏳ 機能フラグ管理
- [ ] ⏳ メンテナンスモード
- [ ] ⏳ 通知設定管理
- [ ] ⏳ API 設定管理

### 8.4 分析・レポート
- [ ] ⏳ 利用統計分析
- [ ] ⏳ ユーザー行動分析
- [ ] ⏳ 売上分析
- [ ] ⏳ 品質分析
- [ ] ⏳ カスタムレポート

---

## 🧪 Phase 9: テスト・品質保証

### 9.1 テストカバレッジ向上
- [x] ✅ ユニットテスト実装（Vitest + React Testing Library）
- [x] ✅ 統合テスト実装（APIルートテスト）
- [x] ✅ E2Eテスト実装（Playwright）
- [ ] 🔄 単体テスト強化（目標: 80%）🎯
- [ ] 🔄 統合テスト追加
- [ ] 🔄 E2E テスト修正・追加
- [ ] ⏳ 視覚回帰テスト
- [ ] ⏳ パフォーマンステスト
- [ ] ⏳ 負荷テスト実施

### 9.2 テストデータ管理
- [x] ✅ テストデータシード機能
- [x] ✅ Playwright認証ファイルのセキュリティ対応（.gitignore追加）
- [ ] 🔄 テストデータファクトリ
- [ ] ⏳ テスト環境自動構築
- [ ] ⏳ テストデータ初期化
- [ ] ⏳ テストデータ検証

### 9.3 CI/CD パイプライン
- [ ] ⏳ GitHub Actions 設定 🎯
- [ ] ⏳ 自動テスト実行
- [ ] ⏳ 自動デプロイ
- [ ] ⏳ コード品質チェック
- [ ] ⏳ セキュリティスキャン

### 9.4 品質管理
- [x] ✅ ESLint 設定
- [x] ✅ Prettier 設定
- [x] ✅ TypeScript 厳格設定
- [ ] ⏳ コードレビュープロセス
- [ ] ⏳ 品質ゲート設定
- [ ] ⏳ セキュリティ監査
- [ ] ⏳ ユーザビリティテスト

---

## 🎨 Phase 10: UI/UX 改善

### 10.1 レスポンシブデザイン
- [x] ✅ 基本レスポンシブ対応
- [x] ✅ Tailwind CSS + shadcn/ui 基盤
- [ ] 🔄 モバイル最適化
- [ ] ⏳ タブレット最適化
- [ ] ⏳ 大画面対応
- [ ] ⏳ 画面サイズ最適化
- [ ] ⏳ PC表示の最適化（1280px〜）

### 10.2 アクセシビリティ
- [ ] ⏳ WCAG 2.1 AA 準拠 🎯
- [ ] ⏳ キーボードナビゲーション
- [ ] ⏳ スクリーンリーダー対応
- [ ] ⏳ 色覚多様性対応
- [ ] ⏳ 音声読み上げ対応
- [ ] ⏳ 色覚異常対応

### 10.3 ユーザビリティ
- [ ] ⏳ ユーザビリティテスト実施
- [ ] ⏳ UI改善実装
- [ ] ⏳ ローディング状態改善
- [ ] ⏳ エラーメッセージ改善
- [ ] ⏳ ヘルプ機能強化

### 10.4 多言語対応準備
- [x] ✅ 日本語UI実装
- [ ] ⏳ i18n システム構築
- [ ] ⏳ 日本語リソース整理
- [ ] ⏳ 英語リソース準備
- [ ] ⏳ 言語切り替え機能
- [ ] ⏳ RTL 対応準備

---

## 🚀 Phase 11: リリース・運用準備

### 11.1 本番環境準備
- [ ] ⏳ 本番データベース設定 🎯
- [ ] ⏳ 本番環境変数設定
- [ ] ⏳ DNS 設定
- [ ] ⏳ SSL 証明書設定
- [ ] ⏳ CDN 設定
- [ ] ⏳ Vercel Pro 環境設定
- [ ] ⏳ ドメイン・SSL証明書設定
- [ ] ⏳ 環境変数管理

### 11.2 法的準備
- [ ] ⏳ 利用規約作成 🎯
- [ ] ⏳ プライバシーポリシー作成
- [ ] ⏳ 特定商取引法表記
- [ ] ⏳ Cookie ポリシー
- [ ] ⏳ 法的審査実施

### 11.3 マーケティング準備
- [ ] ⏳ ランディングページ作成
- [ ] ⏳ 商品紹介動画作成
- [ ] ⏳ プレスリリース準備
- [ ] ⏳ SNS アカウント開設
- [ ] ⏳ SEO 対策実装

### 11.4 運用準備
- [ ] ⏳ 監視システム設定
- [ ] ⏳ アラート設定
- [ ] ⏳ ログ分析環境
- [ ] ⏳ 障害対応手順書作成
- [ ] ⏳ 運用チーム教育
- [ ] ⏳ バックアップ・復旧手順確認
- [ ] ⏳ ユーザーサポート体制構築

### 11.5 βテスト
- [ ] ⏳ βテスト計画策定
- [ ] ⏳ βユーザー募集
- [ ] ⏳ フィードバック収集
- [ ] ⏳ 問題修正実装
- [ ] ⏳ 最終品質確認

---

## 📊 進捗サマリー

### 全体進捗統計
- **完了**: 50+ 項目 ✅
- **進行中**: 15+ 項目 🔄  
- **未着手**: 160+ 項目 ⏳
- **緊急対応必要**: 1 項目 🚨

### フェーズ別進捗
| フェーズ | 完了率 | 状態 | 注記 |
|---------|--------|------|------|
| Phase 0: 基盤・認証 | 100% | ✅ 完了 | |
| Phase 1: ユーザー管理 | 90% | 🔄 ほぼ完了 | |
| Phase 2: 辞書管理 | 90% | 🔄 ほぼ完了 | CSV機能完了 |
| Phase 3: テキストチェック | 90% | 🔄 ほぼ完了 | パフォーマンス改善残り |
| Phase 4: 画像アップロード | 0% | 🚨 **緊急対応必要** | MVP必須・未着手 |
| Phase 5: 履歴・データ管理 | 70% | 🔄 進行中 | |
| Phase 6: 課金・決済 | 5% | ⏳ 一部着手 | |
| Phase 7: 性能・セキュリティ | 0% | ⏳ 未着手 | |
| Phase 8: 管理・運用 | 0% | ⏳ 未着手 | |
| Phase 9: テスト・品質 | 60% | 🔄 進行中 | |
| Phase 10: UI/UX改善 | 70% | 🔄 進行中 | アクセシビリティ残り |
| Phase 11: リリース準備 | 0% | ⏳ 未着手 | |

### MVP 重要度別
- **🎯 MVP必須項目**: 40+ 項目
- **🚨 緊急対応**: 1項目（画像機能）
- **通常優先度**: 180+ 項目

---

## 🎯 優先度別ロードマップ

### 🚨 今週の緊急タスク
1. **画像アップロード機能開始** (Phase 4.1) - ImageChecker コンポーネント作成
2. **画像機能のデータベース設計** (Phase 4.5) - checks テーブル拡張
3. **OCR システム設計** (Phase 4.3) - Tesseract.js 統合準備

### 🎯 今月の重点目標
1. **Phase 4 完了**: 画像アップロード・OCR機能（MVP必須）
2. **Phase 2 完了**: CSV インポート・エクスポート機能
3. **Phase 9 強化**: テスト品質向上（80%カバレッジ）

### 📋 MVP リリース必須項目
1. **Phase 4**: 画像アップロード・OCR機能（🚨緊急）
2. **Phase 6**: 基本的な課金・決済システム
3. **Phase 5**: PDF レポート生成機能
4. **Phase 7**: セキュリティ・パフォーマンス基準達成
5. **Phase 11**: 法的準備・リリース環境構築

### 🔄 継続改善項目
- **テストカバレッジ向上**: 60% → 80%
- **パフォーマンス最適化**: 応答時間5秒以下維持
- **ユーザビリティ改善**: フィードバック対応

---

## 📝 関連ドキュメント

- [要件定義書](./REQUIREMENTS_DEFINITION.md)
- [詳細設計書](./DETAILED_DESIGN.md)  
- [プロジェクト計画書](./PROJECT_PLAN.md)
- [画像アップロード機能仕様書](./IMAGE_UPLOAD_FEATURE_SPEC.md)

---

**作成者**: 開発チーム  
**最終更新**: 2025-08-08  
**次回更新予定**: 毎週月曜日  
**対象リリース**: MVP（2025-09予定）