# TODO - 薬機法チェック SaaS 実装タスク

## 🔧 認証・組織管理

###### 辞書CRUD機能
- [x] 辞書一覧表示UI
- [x] 辞書項目の個別編集UI
- [x] 辞書項目の一括削除機能
- [x] 検索・フィルタリング機能
- [x] 管理者権限チェック
- [x] 組織単位での辞書管理
- [x] `/dictionaries` ルートでの辞書管理ページ機能
- [x] Supabase Auth による認証基盤
- [x] 組織・ユーザーテーブル設計
- [x] 管理者によるユーザー招待機能
- [x] 組織に所属するユーザーの管理（一覧、招待、権限変更）
- [x] ユーザー権限変更機能（admin/user）
- [x] グローバルナビゲーション実装
- [ ] 二段階認証機能（将来対応）

### 組織管理UI
- [ ] 組織設定ページ（未実装）
- [x] ユーザー一覧・管理画面
- [x] ユーザー招待フォーム
- [x] 権限変更UI
- [x] グローバルナビゲーションコンポーネント

## 📝 テキスト入力・チェック機能

### テキスト入力
- [x] 10,000文字制限の実装
- [x] リアルタイム文字数カウント

#### 将来対応
- [ ] ファイルアップロード機能（将来対応）
  - [ ] Word ファイル対応
  - [ ] Markdown ファイル対応
- [ ] URL クロール機能（将来対応）

### 薬機法チェック
- [x] 基本的なチェック機能実装
- [x] プリフィルタ（pg_trgm類似度≥0.3）の最適化
- [x] セマンティック照合（vector距離<0.25）の実装
- [x] LLM呼び出しのシステムプロンプト最適化
- [x] 非同期ジョブ処理の安定化（30秒タイムアウト実装）
- [x] 平均応答時間≤5秒の達成（段階的フィルタリングで性能向上）

### 結果表示
- [x] 2カラム並列表示
- [x] 違反箇所のハイライト表示
- [x] 差分ビュー（inline/side-by-side）
- [ ] ハイライト色・UI の改善（未実装）
- [ ] 違反箇所の詳細情報表示（未実装）

## 📚 組織辞書管理

### 辞書CRUD機能
- [x] 辞書一覧表示UI
- [x] 辞書項目の個別編集UI
- [x] 辞書項目の一括削除機能
- [x] 検索・フィルタリング機能

### CSV インポート・エクスポート
- [ ] CSV インポート機能（未実装）
- [ ] CSV エクスポート機能（未実装）
- [ ] CSVフォーマットバリデーション（未実装）
- [ ] インポートエラーハンドリング（未実装）

### Embedding機能
- [x] 辞書登録時の自動embedding生成
- [ ] embedding更新の非同期処理（未実装）
- [ ] Upstash QStash によるリトライ機構（未実装）
- [x] `POST /api/dictionaries/embeddings/refresh` API実装

## 📊 履歴管理

### チェック履歴
- [ ] ユーザー個人の履歴一覧画面（未実装）
- [ ] 管理者による組織全体の履歴検索（未実装）
- [ ] 履歴の論理削除機能（未実装）
- [ ] 履歴の詳細表示・再実行機能（未実装）

### データの永続保存
- [x] チェック結果のDB保存
- [ ] 大量データの効率的な表示（ページネーション）（未実装）
- [ ] 履歴の検索・ソート機能（未実装）

## 🔔 通知・リアルタイム更新

### Server-Sent Events (SSE)
- [x] `/api/checks/{id}/stream` エンドポイント
- [x] 基本的な進捗通知
- [ ] エラーハンドリングの改善（部分実装）
- [ ] 接続タイムアウト処理の最適化（部分実装）
- [ ] 複数チェック同時実行対応（未実装）

## 📤 データエクスポート

### クリップボード機能
- [x] 修正文のコピー機能
- [ ] 原文のコピー機能（未実装）
- [ ] diff形式のコピー機能（未実装）

### PDF レポート
- [ ] ハイライト付きPDFレポート生成（未実装）
- [ ] レポートのダウンロード機能（未実装）
- [ ] レポートテンプレートの作成（未実装）

## 💳 課金・決済機能

### 利用制限管理
- [ ] トライアル期間管理（30日・200チェック）（未実装）
- [ ] 月間チェック数の制限・カウント（未実装）
- [ ] 超過時の従量課金処理（未実装）

### 決済システム
- [ ] Stripe または Pay.jp との連携（未実装）
- [ ] クレジットカード決済機能（未実装）
- [ ] 銀行振込対応（未実装）
- [ ] 月次請求処理（未実装）

### 請求書・領収書
- [ ] PDF請求書の自動生成（未実装）
- [ ] 領収書の自動発行（未実装）
- [ ] インボイス対応（未実装）
- [ ] メール送付機能（未実装）

## 🎨 UI/UX改善

### レスポンシブデザイン
- [x] Tailwind CSS + shadcn/ui 基盤
- [ ] モバイル最適化（375px〜）（部分実装）
- [ ] タブレット対応（部分実装）
- [ ] PC表示の最適化（1280px〜）（部分実装）

### アクセシビリティ
- [ ] WCAG 2.1 AA 相当への対応
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] 色覚異常対応

### 国際化
- [x] 日本語UI実装
- [ ] i18n機構の実装（将来の多言語対応準備）（未実装）

## ⚡ 性能・インフラ最適化

### パフォーマンス
- [ ] 同時アクセス50ユーザー対応
- [ ] 月間10,000チェック処理能力
- [ ] データベースクエリ最適化
- [ ] CDN活用による高速化

### 監視・ログ
- [ ] Vercel Analytics 設定
- [ ] Supabase Logs 活用
- [ ] エラー監視・アラート設定
- [ ] 90日ログ保持・自動ローテート

### バックアップ・セキュリティ
- [ ] DBスナップショット（1回/日）設定
- [ ] 7日PITR設定
- [ ] TLS1.2+ 強制
- [ ] at-rest AES-256暗号化確認

## 🧪 テスト・品質保証

### 自動テスト
- [x] ユニットテスト実装（Vitest + React Testing Library）
- [x] 統合テスト実装（APIルートテスト）
- [x] E2Eテスト実装（Playwright）
- [ ] CI/CD パイプライン構築（未実装）

### 品質管理
- [ ] コードレビュープロセス
- [ ] セキュリティ監査
- [ ] 負荷テスト実施
- [ ] ユーザビリティテスト

## 📈 運用・保守

### デプロイメント
- [ ] Vercel Pro 環境設定（未実装）
- [ ] 本番環境への移行（未実装）
- [ ] ドメイン・SSL証明書設定（未実装）
- [ ] 環境変数管理（未実装）

### 運用体制
- [ ] 障害対応手順書作成（未実装）
- [ ] バックアップ・復旧手順確認（未実装）
- [ ] ユーザーサポート体制構築（未実装）
- [ ] 利用規約・プライバシーポリシー作成（未実装）

---

## 🎯 MVP リリース優先度

### 高優先度（MVP必須）
- 管理者によるユーザー招待機能
- 組織辞書管理UI（CRUD）
- 課金・決済機能
- 基本的なPDFレポート機能

### 中優先度（リリース後早期対応）
- CSV インポート・エクスポート
- 履歴管理UI
- パフォーマンス最適化
- 自動テスト実装

### 低優先度（将来対応）
- ファイルアップロード機能
- URL クロール機能
- 二段階認証
- 多言語対応

---

**最終更新:** 2025-01-07  
**対象リリース:** MVP（2025-09予定）  
**実装状況確認:** 完了項目は✅、未実装項目は[ ]（未実装）で明記 